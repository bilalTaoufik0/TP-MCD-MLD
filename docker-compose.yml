version : '3'

services:
  nginx:
    image: nginx:1.22-alpine
    ports:
      - "8080:80"
    volumes:
      - ./code:/code
      - ./nginx.conf:/etc/nginx/nginx.conf
  php:
    build:
    context: .
    dockerfile: dockerfile
    container_name: php73
    depends_on:
    - db
    image: php:7.3-apache
    volumes:
    - ./php:/var/www/html/
    ports:
    - 80:80
  db:
    container_name: mysql8
    image: mysql:8.0
    command: --default-authentication-plugin=mysql_native_password
    environment:
    MYSQL_ROOT_PASSWORD: root
    MYSQL_DATABASE: appdb
    MYSQL_USER: eleve
    MYSQL_PASSWORD: eleve
    ports:
    - 3306:3306
  phpmya:
    image: phpmyadmin/phpmyadmin:latest
    container_name: phpmyadmin
    environment:
    PMA_ARBITRARY: 1
    PMA_HOST: db
    PMA_USER: eleve
    PMA_PASSWORD: eleve
    UPLOAD_LIMIT: 20M
    ports:
      - "8081:80"

volumes:
  dbdata:
    driver: local
    driver_opts:
      type: "nfs"
      o: "addr=192.168.1.100,rw"
      device: ":/path/to/shared/folder"
